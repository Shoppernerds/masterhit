<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MasterHit | Cartas Pokémon en Chile</title>
<meta name="description" content="MasterHit: tienda de cartas Pokémon con carrito y checkout por Webpay. Envíos a todo Chile." />
<meta property="og:title" content="MasterHit | Cartas Pokémon en Chile">
<meta property="og:description" content="Cajas selladas, ETB, boosters y singles. Envíos a todo Chile.">
<meta property="og:type" content="website">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Ccircle cx='128' cy='128' r='120' fill='%23e60000'/%3E%3Ccircle cx='128' cy='128' r='88' fill='%23fff'/%3E%3Ccircle cx='128' cy='128' r='40' fill='%23000'/%3E%3C/svg%3E">
<style>
:root{--bg:#0b0b0c;--card:#111215;--muted:#9aa2ae;--line:#20242b;--fg:#f5f7fb;--accent:#e60000;--accent-2:#fff;--radius:16px;--shadow:0 10px 30px rgba(0,0,0,.45)}
*{box-sizing:border-box}html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
a{color:inherit;text-decoration:none}img{max-width:100%;display:block}
.container{max-width:1200px;margin:0 auto;padding:20px}

/* NAV */
.nav{position:sticky;top:0;z-index:50;background:#000;border-bottom:2px solid var(--accent)}
.nav-inner{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 20px}
.brand{display:flex;gap:10px;align-items:center;font-weight:800;color:var(--accent-2)}
/* Pokébola */
.brand-badge{position:relative;width:28px;height:28px;border-radius:999px;background:
  linear-gradient(#e60000 0 50%, #fff 50% 100%);
  box-shadow:0 0 0 3px #000,0 0 0 6px #fff;overflow:hidden}
.brand-badge:before{content:"";position:absolute;left:0;right:0;top:50%;height:3px;background:#000;transform:translateY(-50%)}
.brand-badge:after{content:"";position:absolute;inset:0;display:block;margin:auto;width:10px;height:10px;border-radius:50%;background:#000;box-shadow:0 0 0 3px #fff,0 0 0 5px #000}

/* Buttons */
.btn{cursor:pointer;border-radius:12px;border:1px solid var(--line);background:var(--card);color:var(--fg);padding:10px 14px;display:inline-flex;align-items:center;gap:8px}
.btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
.cart-count{display:inline-flex;min-width:22px;height:22px;border-radius:999px;align-items:center;justify-content:center;background:#fff;color:#000;font-weight:800;font-size:.85rem;padding:0 6px}

/* HERO */
.hero{padding:36px 20px;text-align:center;background:#111}
.hero h1{font-size:1.6rem;color:#fff;margin:0}

/* TRUST */
.trust{display:grid;grid-template-columns:1fr;gap:10px;padding:14px 20px}
.tile{background:#0f1116;border:1px solid var(--line);border-radius:12px;padding:12px;display:flex;gap:10px;align-items:flex-start}
.tile b{display:block}

/* GRID */
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:0 20px}
.counter{color:var(--muted)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;padding:20px}
.product{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;position:relative}
.product img{height:200px;object-fit:contain;background:#fff}
.pad{padding:12px;flex:1;display:flex;flex-direction:column;gap:8px}
.price{font-weight:800;color:var(--accent-2)}
.badge{background:var(--accent);color:#fff;padding:4px 8px;border-radius:6px;font-size:.8rem;position:absolute;margin:6px}
.badge.low{background:rgba(245,158,11,.15);color:#fde68a;border:1px solid rgba(245,158,11,.35)}
.badge.oos{background:#444;color:#ddd;border:1px solid #666}
.qty{display:flex;gap:8px;align-items:center;margin-top:4px}
.qty button{width:30px;height:30px;border-radius:8px;border:1px solid var(--line);background:#0f1116;color:var(--fg)}

/* Drawer */
.drawer{position:fixed;right:0;top:0;height:100%;width:420px;max-width:100%;background:#111;color:#fff;border-left:2px solid var(--accent);transform:translateX(100%);transition:.3s;z-index:100;display:flex;flex-direction:column}
.drawer.open{transform:translateX(0)}
.row{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;border:1px solid var(--line);border-radius:12px;padding:8px}
.row img{width:64px;height:64px;object-fit:contain;background:#fff}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;place-items:center;z-index:90}
.modal.open{display:grid}
.modal-card{width:min(900px,95vw);background:#111;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
.modal-body{display:grid;grid-template-columns:1fr 1fr;gap:16px;padding:16px}
.thumbs{display:flex;gap:8px;flex-wrap:wrap}
.thumbs img{width:64px;height:64px;object-fit:contain;background:#fff;border:1px solid var(--line);border-radius:8px;cursor:pointer}
@media (max-width:800px){.modal-body{grid-template-columns:1fr}}

/* Footer */
footer{padding:24px 20px;background:#000;color:#fff;margin-top:30px}
.footer-inner{max-width:1200px;margin:0 auto;display:grid;gap:6px;justify-items:start}
.footer-title{font-weight:800;font-size:1.1rem}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav" aria-label="Barra superior">
  <div class="nav-inner container">
    <a href="#" class="brand" aria-label="MasterHit inicio"><span class="brand-badge" aria-hidden="true"></span> MASTERHIT</a>
    <div class="toolbar">
      <button id="btnCart" class="btn primary" aria-haspopup="dialog" aria-controls="drawer">
        🛒 Ver tu Carrito de Compras <span class="cart-count" id="cCount">0</span>
      </button>
    </div>
  </div>
</nav>

<!-- HERO (mensaje único) -->
<section class="hero" aria-label="Mensaje principal">
  <h1>Pokemon TCG al mejor precio y con entrega rápida en Huechuraba, Lampa, Colina y Quilicura.</h1>
</section>

<!-- TRUST (solo despacho) -->
<div class="trust container" aria-label="Sellos de confianza">
  <div class="tile">⚡ <div><b>Despachos en 24 horas o menos</b><span class="muted"> en Zona Norte de Santiago</span></div></div>
</div>

<!-- CONTROLS -->
<div class="controls container">
  <span id="counter" class="counter">Cargando productos…</span>
</div>

<!-- GRID -->
<section class="container">
  <div id="grid" class="grid" aria-live="polite"></div>
</section>

<!-- DRAWER CARRITO -->
<aside id="drawer" class="drawer" aria-hidden="true" role="dialog" aria-label="Carrito de compras">
  <header style="padding:12px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center">
    <strong>Tu carrito</strong>
    <button id="btnClose" class="btn" aria-label="Cerrar carrito">✕</button>
  </header>
  <div id="cartBody" style="flex:1;overflow:auto;padding:12px"></div>
  <div style="padding:12px;border-top:1px solid var(--line)">
    <div>Subtotal: <strong id="subtotal">—</strong></div>
    <div>Total: <strong id="grand">—</strong></div>
    <button id="btnCheckout" class="btn primary" style="margin-top:10px;width:100%">Proceder a pago (Webpay)</button>
    <small class="muted">* Simulado; conecta tu backend Webpay en <span class="link">/api/pay/webpay/create</span>.</small>
  </div>
</aside>

<!-- MODAL DETALLE -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-label="Detalle de producto">
  <div class="modal-card">
    <header style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line)">
      <strong id="mTitle"></strong>
      <button id="mClose" class="btn" aria-label="Cerrar detalle">✕</button>
    </header>
    <div class="modal-body">
      <div>
        <img id="mImage" src="" alt="" style="width:100%;height:360px;object-fit:contain;background:#fff" loading="lazy" decoding="async" />
        <div id="mThumbs" class="thumbs" aria-label="Galería miniaturas"></div>
      </div>
      <div>
        <p id="mMeta" class="muted"></p>
        <p><strong id="mPrice"></strong></p>
        <div class="qty" style="margin:10px 0">
          <button class="btn" id="mDec" aria-label="Disminuir">−</button>
          <input class="input" id="mQty" style="width:60px;text-align:center" type="number" min="1" value="1" aria-label="Cantidad">
          <button class="btn" id="mInc" aria-label="Aumentar">+</button>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="mAdd" class="btn primary">Añadir al carrito</button>
          <button id="mView" class="btn">Ver imagen completa</button>
        </div>
        <p id="mDesc" class="muted" style="margin-top:12px"></p>
      </div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="footer-inner">
    <div class="footer-title">MasterHit</div>
    <div>Los Nogales 1135, Valle Grande, Lampa</div>
    <div>Lunes a Viernes 14:00 a 21:00 hrs</div>
    <div>Sábados y Domingos 12:00 a 20:00 hrs</div>
    <a class="btn primary" href="https://wa.me/56975121963" target="_blank" rel="noopener">📲 Contacta a un ejecutivo</a>
  </div>
</footer>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const $=s=>document.querySelector(s), fmt=n=>new Intl.NumberFormat('es-CL',{style:'currency',currency:'CLP',maximumFractionDigits:0}).format(n||0);
  let PRODUCTS=[], CART=JSON.parse(localStorage.getItem('mh_cart')||'[]'), CURRENT=null;

  const FALLBACK=[{id:'etb-151',name:'Elite Trainer Box 151',set:'SV151',price:49990,stock:12,image:'https://dummyimage.com/600x400/fff/000&text=ETB+151'},
    {id:'upc-charizard',name:'Ultra Premium Charizard',set:'Promo',price:129990,stock:5,image:'https://dummyimage.com/600x400/fff/000&text=UPC+Charizard'},
    {id:'booster-box',name:'Booster Box Scarlet & Violet',set:'SV Base',price:159990,stock:3,image:'https://dummyimage.com/600x400/fff/000&text=Booster+Box'}];

  const grid=$('#grid'),counter=$('#counter'),btnCart=$('#btnCart'),drawer=$('#drawer'),btnClose=$('#btnClose'),
        cartBody=$('#cartBody'),subtotalEl=$('#subtotal'),grandEl=$('#grand'),cCount=$('#cCount'),
        btnCheckout=$('#btnCheckout'),
        modal=$('#modal'),mClose=$('#mClose'),mTitle=$('#mTitle'),mImage=$('#mImage'),mThumbs=$('#mThumbs'),
        mMeta=$('#mMeta'),mPrice=$('#mPrice'),mQty=$('#mQty'),mDec=$('#mDec'),mInc=$('#mInc'),mAdd=$('#mAdd'),mView=$('#mView'),mDesc=$('#mDesc');

  async function loadCatalog(){
    try{const r=await fetch('./masterhit-products.json?_='+Date.now()); if(!r.ok) throw 0; const d=await r.json(); PRODUCTS=Array.isArray(d)&&d.length?d:FALLBACK;}
    catch{PRODUCTS=FALLBACK}
    counter.textContent=`${PRODUCTS.length} productos cargados`;
  }

  function getList(){ // sin filtro ni ordenar: solo stock primero
    const list=[...PRODUCTS].sort((a,b)=>(b.stock|0)-(a.stock|0));
    counter.textContent=`${list.length} resultados`;
    return list;
  }

  function render(){
    grid.innerHTML=getList().map(p=>{
      const low=(p.stock|0)>0&&(p.stock|0)<=3,oos=(p.stock|0)===0;
      return `<article class="product">
        ${oos?`<span class="badge oos">Sin stock</span>`:low?`<span class="badge low">¡Quedan ${p.stock}!</span>`:''}
        <img src="${p.image}" alt="${p.name}" loading="lazy" decoding="async" referrerpolicy="no-referrer">
        <div class="pad">
          <strong>${p.name}</strong>
          <span class="muted">${[p.set,p.type].filter(Boolean).join(' • ')}</span>
          <span class="price">${fmt(p.price)}</span>
          <div class="qty">
            <button class="btn" data-dec data-id="${p.id}">−</button>
            <input class="input" style="width:60px;text-align:center" type="number" min="1" value="1" data-qty="${p.id}">
            <button class="btn" data-inc data-id="${p.id}">+</button>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn primary" data-add data-id="${p.id}" ${oos?'disabled':''}>Añadir</button>
            <button class="btn" data-view data-id="${p.id}">Ver detalle</button>
          </div>
        </div>
      </article>`;}).join('')||'<p class="muted">Sin resultados.</p>';
  }

  function openModal(p){
    CURRENT=p;mTitle.textContent=p.name;mImage.src=p.image;mMeta.textContent=[p.set,p.type,p.category].filter(Boolean).join(' • ');
    mPrice.textContent=fmt(p.price);mDesc.textContent=p.description||'';mQty.value=1;
    const gal=Array.isArray(p.images)&&p.images.length?p.images:[p.image];
    mThumbs.innerHTML=gal.map(s=>`<img src="${s}" data-src="${s}" alt="thumb" loading="lazy">`).join('');
    modal.classList.add('open');
  }
  function closeModal(){modal.classList.remove('open');CURRENT=null;}

  function saveCart(){localStorage.setItem('mh_cart',JSON.stringify(CART))}
  function cartLines(){return CART.map(it=>{const p=PRODUCTS.find(x=>x.id===it.id)||{};return {...p,qty:it.qty,lineTotal:(p.price||0)*it.qty};})}
  function updateBadge(){cCount.textContent=CART.reduce((s,i)=>s+i.qty,0)}
  function drawCart(){
    const lines=cartLines();
    cartBody.innerHTML=lines.map(l=>`
      <div class="row">
        <img src="${l.image}" alt="${l.name}" loading="lazy">
        <div>
          <div style="display:flex;justify-content:space-between;gap:8px"><strong>${l.name}</strong><span>${fmt(l.price)}</span></div>
          <div class="qty" style="margin-top:6px">
            <button class="btn" data-plus data-id="${l.id}">+</button>
            <input class="input" style="width:60px;text-align:center" type="number" min="1" value="${l.qty}" data-q="${l.id}">
            <button class="btn" data-minus data-id="${l.id}">−</button>
            <button class="btn" style="margin-left:auto" data-del data-id="${l.id}">🗑️</button>
          </div>
        </div>
        <div><strong>${fmt(l.lineTotal)}</strong></div>
      </div>`).join('')||'<p class="muted">Tu carrito está vacío.</p>';
    const subtotal=lines.reduce((s,l)=>s+l.lineTotal,0); subtotalEl.textContent=fmt(subtotal); grandEl.textContent=fmt(subtotal);
  }
  function addToCart(id,qty=1){const p=PRODUCTS.find(x=>x.id===id); if(!p|| (p.stock|0)<=0) return; const line=CART.find(x=>x.id===id);
    if(line){line.qty=Math.min(line.qty+qty,p.stock|0)}else{CART.push({id,qty:Math.min(qty,p.stock|0||qty)})}
    saveCart();updateBadge();openCart();drawCart();}
  function setQty(id,qty){qty=Math.max(1,qty|0);const p=PRODUCTS.find(x=>x.id===id),line=CART.find(x=>x.id===id); if(!line||!p) return;
    line.qty=Math.min(qty,p.stock|0||qty); saveCart();updateBadge();drawCart();}
  function removeFromCart(id){CART=CART.filter(x=>x.id!==id);saveCart();updateBadge();drawCart();}
  function openCart(){drawer.classList.add('open');drawer.setAttribute('aria-hidden','false');drawCart()}
  function closeCart(){drawer.classList.remove('open');drawer.setAttribute('aria-hidden','true')}

  // Eventos
  btnCart.addEventListener('click',openCart); btnClose.addEventListener('click',closeCart);
  document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeCart();closeModal()}});

  grid.addEventListener('click',e=>{
    const add=e.target.closest('[data-add]'),inc=e.target.closest('[data-inc]'),dec=e.target.closest('[data-dec]'),view=e.target.closest('[data-view]');
    if(add){const id=add.dataset.id;const qtyEl=grid.querySelector(`[data-qty="${id}"]`); addToCart(id,Math.max(1,parseInt(qtyEl?.value||'1',10)));}
    if(inc){const id=inc.dataset.id;const qEl=grid.querySelector(`[data-qty="${id}"]`); if(qEl) qEl.value=(parseInt(qEl.value||'1',10)+1)}
    if(dec){const id=dec.dataset.id;const qEl=grid.querySelector(`[data-qty="${id}"]`); if(qEl) qEl.value=Math.max(1,parseInt(qEl.value||'1',10)-1)}
    if(view){const id=view.dataset.id;const p=PRODUCTS.find(x=>x.id===id); if(p) openModal(p);}
  });

  cartBody.addEventListener('click',e=>{
    const plus=e.target.closest('[data-plus]'),minus=e.target.closest('[data-minus]'),del=e.target.closest('[data-del]');
    if(plus){const id=plus.dataset.id;const inp=cartBody.querySelector(`[data-q="${id}"]`); if(inp){inp.value=parseInt(inp.value||'1',10)+1; setQty(id,+inp.value)}}
    if(minus){const id=minus.dataset.id;const inp=cartBody.querySelector(`[data-q="${id}"]`); if(inp){inp.value=Math.max(1,parseInt(inp.value||'1',10)-1); setQty(id,+inp.value)}}
    if(del){removeFromCart(del.dataset.id)}
  });
  cartBody.addEventListener('change',e=>{const i=e.target.closest('[data-q]'); if(i){setQty(i.dataset.q,+i.value||1)}});

  mClose.addEventListener('click',closeModal);
  modal.addEventListener('click',e=>{if(e.target===modal) closeModal()});
  mDec.addEventListener('click',()=>mQty.value=Math.max(1,(+mQty.value||1)-1));
  mInc.addEventListener('click',()=>mQty.value=(+mQty.value||1)+1);
  mAdd.addEventListener('click',()=>{if(CURRENT) addToCart(CURRENT.id,+mQty.value||1)});
  mView.addEventListener('click',()=>{if(CURRENT) window.open(CURRENT.image||(CURRENT.images&&CURRENT.images[0])||'', '_blank')});

  (async()=>{await loadCatalog();render();updateBadge()})();
});
</script>
</body>
</html>

